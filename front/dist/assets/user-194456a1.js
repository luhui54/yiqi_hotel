import{aj as c,K as u,ak as l,al as p,W as a,am as h}from"./index-98ff7959.js";const s=c.create({baseURL:"https://www.markerhub.com",timeout:1e4});let n=null;s.interceptors.request.use(e=>{n||(n=u({message:"数据加载中...",duration:0,icon:l(p)}));const r=i();return r.userToken&&(e.headers.userToken=r.userToken),e},e=>Promise.reject(e));s.interceptors.response.use(e=>{n.close();const r=i(),t=e.data;return t.code===200?t:t.code===401?(r.logout(),a.push({path:"/login",query:{redirect:a.currentRoute.value.fullPath}}).then(),Promise.reject("未登录")):(u.error(t.msg),Promise.reject(new Error(t.msg)))},e=>{if(n.close(),e.response){let{data:r}=e.response;u.error(r.msg)}return Promise.reject(e)});function g(e){return s({url:"/app/login",method:"post",data:e})}function m(){return s({url:"/app/logout",method:"get"})}function f(){return s({url:"/app/captcha",method:"get"})}function k(e){return s({url:"/app/register",method:"post",data:e})}const i=h("user",{state:()=>({userToken:"",userInfo:{}}),persist:!0,getters:{},actions:{login(e){return new Promise((r,t)=>{g(e).then(o=>{this.userToken=o.data.userToken,this.userInfo=o.data.userInfo,r()}).catch(o=>{t(o)})})},logout(){m().then(e=>{this.userToken="",this.userInfo={}})},updateUserInfo(e){this.userInfo=e}}});export{f as G,k as R,s,i as u};
