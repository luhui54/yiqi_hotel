import{J as h,r as y,C as N,d as u,o as $,a as z,w as l,e,l as M,h as d,K as E,E as P,z as V,L as F}from"./index-98ff7959.js";import{U as A}from"./UploadImg-bd809d4c.js";import"./user-194456a1.js";function O(m){return h({url:"/sys/admin/page",method:"get",params:m})}function R(m){return h({url:"/sys/admin/info/"+m,method:"get"})}function G(m){return h({url:"/sys/admin/save",method:"post",data:m})}function J(m){return h({url:"/sys/admin/delete",method:"post",data:m})}function K(m){return h({url:"/sys/admin/resetPwd",method:"post",params:{id:m}})}const j={__name:"edit",emits:["handleClose"],setup(m,{expose:o,emit:f}){const g=y(!1),n=y({});o({init:c=>{g.value=!0,c?R(c).then(r=>{n.value=r.data}):n.value={}}});const k=N({avatar:[{required:!0,message:"此项是必填项",trigger:"blur"}],username:[{required:!0,message:"此项是必填项",trigger:"blur"}],email:[{required:!0,message:"此项是必填项",trigger:"blur"}],role:[{required:!0,message:"此项是必填项",trigger:"blur"}]}),H=f,C=c=>{g.value=!1,H("handleClose",c)},w=y(),x=()=>{w.value.validate((c,r)=>{c&&G(n.value).then(t=>{E.success("操作成功"),C(!0)})})};return(c,r)=>{const t=u("el-form-item"),a=u("el-input"),D=u("el-alert"),v=u("el-option"),_=u("el-select"),T=u("el-button"),p=u("el-form"),U=u("el-drawer");return $(),z(U,{modelValue:g.value,"onUpdate:modelValue":r[6]||(r[6]=s=>g.value=s),title:"新增或编辑"},{default:l(()=>[e(p,{ref_key:"formRef",ref:w,style:{"max-width":"600px"},model:n.value,rules:k,"label-width":"auto"},{default:l(()=>[e(t,{label:"头像",prop:"avatar"},{default:l(()=>[e(A,{images:n.value.avatar,"onUpdate:images":r[0]||(r[0]=s=>n.value.avatar=s),limit:1},null,8,["images"])]),_:1}),e(t,{label:"管理员名称",prop:"username"},{default:l(()=>[e(a,{modelValue:n.value.username,"onUpdate:modelValue":r[1]||(r[1]=s=>n.value.username=s)},null,8,["modelValue"]),n.value.id?M("",!0):($(),z(D,{key:0,title:"默认密码：888888，请在创建后及时修改密码"}))]),_:1}),e(t,{label:"邮箱",prop:"email"},{default:l(()=>[e(a,{modelValue:n.value.email,"onUpdate:modelValue":r[2]||(r[2]=s=>n.value.email=s)},null,8,["modelValue"])]),_:1}),e(t,{label:"角色",prop:"role"},{default:l(()=>[e(_,{modelValue:n.value.role,"onUpdate:modelValue":r[3]||(r[3]=s=>n.value.role=s)},{default:l(()=>[e(v,{label:"ADMIN",value:"ADMIN"}),e(v,{label:"HOTEL",value:"HOTEL"})]),_:1},8,["modelValue"])]),_:1}),e(t,{label:"管理酒店",prop:"hotelId"},{default:l(()=>[e(a,{modelValue:n.value.hotelId,"onUpdate:modelValue":r[4]||(r[4]=s=>n.value.hotelId=s)},null,8,["modelValue"])]),_:1}),e(t,{label:"手机号",prop:"phone"},{default:l(()=>[e(a,{modelValue:n.value.phone,"onUpdate:modelValue":r[5]||(r[5]=s=>n.value.phone=s)},null,8,["modelValue"])]),_:1}),e(t,null,{default:l(()=>[e(T,{type:"primary",onClick:x},{default:l(()=>[d("提交")]),_:1}),e(T,{onClick:C},{default:l(()=>[d("关闭")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}},Y={__name:"index",setup(m){const o=N({searchForm:{},pageData:[],page:{current:1,size:10},total:0,infoDrawer:!1,user:{}}),f=()=>{O({...o.page,...o.searchForm}).then(t=>{o.pageData=t.data.records,o.total=t.data.total})};f();const g=t=>{o.page.current=t,f()},n=t=>{R(t).then(a=>{o.user=a.data,o.infoDrawer=!0})},B=y(),k=t=>{B.value.init(t)},H=t=>{t&&f()},C=y(!0);let w=[];const x=t=>{const a=[];t?a.push(t):a.push(...w),F.confirm("确认删除该记录吗？","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{J(a).then(D=>{E.success("删除成功"),f()})})},c=t=>{C.value=t.length===0,w=t.map(a=>a.id)},r=t=>{F.confirm("确认重置密码为888888吗？","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{K(t).then(a=>{E.success("重置成功")})})};return(t,a)=>{const D=u("el-input"),v=u("el-form-item"),_=u("el-button"),T=u("el-form"),p=u("el-table-column"),U=u("el-avatar"),s=u("el-table"),S=u("el-pagination"),b=u("el-descriptions-item"),q=u("el-descriptions"),L=u("el-drawer");return $(),P("div",null,[e(T,{"label-width":"auto",inline:!0},{default:l(()=>[e(v,null,{default:l(()=>[e(D,{modelValue:o.searchForm.username,"onUpdate:modelValue":a[0]||(a[0]=i=>o.searchForm.username=i),placeholder:"用户名"},null,8,["modelValue"])]),_:1}),e(v,null,{default:l(()=>[e(_,{onClick:f},{default:l(()=>[d("搜索")]),_:1})]),_:1}),e(v,null,{default:l(()=>[e(_,{type:"primary",onClick:a[1]||(a[1]=i=>k(null))},{default:l(()=>[d("新增")]),_:1})]),_:1}),e(v,null,{default:l(()=>[e(_,{type:"danger",onClick:a[2]||(a[2]=i=>x(null)),disabled:C.value},{default:l(()=>[d("批量删除")]),_:1},8,["disabled"])]),_:1})]),_:1}),e(s,{data:o.pageData,border:"",style:{width:"100%"},onSelectionChange:c},{default:l(()=>[e(p,{type:"selection",width:"55"}),e(p,{prop:"avatar",label:"头像"},{default:l(i=>[e(U,{src:i.row.avatar},null,8,["src"])]),_:1}),e(p,{prop:"username",label:"用户名"}),e(p,{prop:"role",label:"角色"}),e(p,{prop:"hotelTitle",label:"管理酒店"}),e(p,{prop:"email",label:"email"}),e(p,{prop:"phone",label:"手机号码"}),e(p,{prop:"createTime",label:"创建时间"}),e(p,{label:"操作"},{default:l(i=>[e(_,{type:"text",onClick:I=>n(i.row.id)},{default:l(()=>[d("查看")]),_:2},1032,["onClick"]),e(_,{type:"text",onClick:I=>k(i.row.id)},{default:l(()=>[d("编辑")]),_:2},1032,["onClick"]),e(_,{type:"text",onClick:I=>x(i.row.id)},{default:l(()=>[d("删除")]),_:2},1032,["onClick"]),e(_,{type:"text",onClick:I=>r(i.row.id)},{default:l(()=>[d("重置密码")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e(S,{style:{"margin-top":"16px"},background:"",layout:"total, prev, pager, next","page-size":o.page.size,total:o.total,onCurrentChange:g},null,8,["page-size","total"]),e(L,{modelValue:o.infoDrawer,"onUpdate:modelValue":a[4]||(a[4]=i=>o.infoDrawer=i),title:"详情"},{default:l(()=>[e(q,{border:"",column:"2",title:"详情"},{default:l(()=>[e(b,{label:"头像"},{default:l(()=>[e(U,{src:o.user.avatar},null,8,["src"])]),_:1}),e(b,{label:"用户名"},{default:l(()=>[d(V(o.user.username),1)]),_:1}),e(b,{label:"手机号码"},{default:l(()=>[d(V(o.user.phone),1)]),_:1}),e(b,{label:"email"},{default:l(()=>[d(V(o.user.email),1)]),_:1}),e(b,{label:"创建时间"},{default:l(()=>[d(V(o.user.createTime),1)]),_:1}),e(b,{label:"最后登录"},{default:l(()=>[d(V(o.user.lastLoginTime),1)]),_:1})]),_:1}),e(_,{style:{"margin-top":"16px"},onClick:a[3]||(a[3]=i=>o.infoDrawer=!1)},{default:l(()=>[d("关闭")]),_:1})]),_:1},8,["modelValue"]),e(j,{ref_key:"editRef",ref:B,onHandleClose:H},null,512)])}}};export{Y as default};
